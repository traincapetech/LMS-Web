import e,{Component as t}from"react";var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},o(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var r=function(){return r=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)},a=function(t){function o(e){var o=t.call(this,e)||this;return o.origin="https://commerce.coinbase.com",o.uuid=o.generateUUID(),o.listenerHandleMessage=function(e){o.handleMessage(e)},o.state={loading:!0,src:null},o}return n(o,t),o.prototype.componentDidMount=function(){window.addEventListener("message",this.listenerHandleMessage);var e=window.location,t=e.hostname,o=e.port,n=e.protocol,r="".concat(n,"//").concat(t).concat(o?":".concat(o):"","/");this.setState({src:this.buildSrc(r)})},o.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.listenerHandleMessage)},o.prototype.render=function(){var t=this,o=this.state,n=o.loading,r=o.src;return e.createElement("div",{className:"coinbase-commerce-iframe-container"},(n||null===r)&&e.createElement("div",{className:"commerce-loading-spinner"}),null!==r&&e.createElement("iframe",{onLoad:function(){t.handleIFrameLoaded()},className:"coinbase-commerce-iframe",src:r,style:{border:0},scrolling:"no"}))},o.prototype.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},o.prototype.buildSrc=function(e){var t,o,n=this.props,r=n.checkoutId,a=n.chargeId,c=n.customMetadata,i=n.disableCaching;if(r)o=r,t="checkout";else{if(!a)throw new Error("must supply either checkoutId or chargeId prop");o=a,t="charges"}var s={origin:e,buttonId:this.uuid,cacheDisabled:i};c&&("string"!=typeof c?console.error('Received customMetadata not of "string" type. Ignoring.'):s.custom=c);var l=Object.keys(s).map((function(e){return"".concat(window.encodeURIComponent(e),"=").concat(window.encodeURIComponent(s[e]))})).join("&");return"".concat(this.origin,"/embed/").concat(t,"/").concat(encodeURI(o),"?").concat(l)},o.prototype.isValidMessage=function(e){return e.origin===this.origin&&e.data.buttonId===this.uuid},o.prototype.handleMessage=function(e){if(this.isValidMessage(e)){var t=this.props,o=t.onChargeSuccess,n=t.onChargeFailure,r=t.onModalClose,a=t.onError,c=t.onPaymentDetected;switch(e.data.event){case"charge_confirmed":null==o||o(e.data);break;case"charge_failed":null==n||n(e.data);break;case"payment_detected":null==c||c(e.data);break;case"error_not_found":a(e.data);break;case"checkout_modal_closed":r()}}},o.prototype.handleIFrameLoaded=function(){var e,t;this.setState({loading:!1}),null===(t=(e=this.props).onLoad)||void 0===t||t.call(e)},o}(t),c=function(t){function o(e){var o=t.call(this,e)||this;return o.state={showModal:!1},o}return n(o,t),o.prototype.onClick=function(){this.setState({showModal:!0})},o.prototype.onModalClose=function(){var e=this.props.onModalClosed;this.setState({showModal:!1}),null!=e&&e()},o.prototype.handleError=function(e){console.error(e),this.onModalClose()},o.prototype.getButtonProps=function(){var e=this,t=["onLoad","onChargeSuccess","onChargeFailure","customMetadata","onPaymentDetected","onModalClosed","checkoutId","chargeId","disableCaching","wrapperStyle","styled"];return Object.keys(r({},this.props)).filter((function(e){return!t.includes(e)})).reduce((function(t,o){var n;return r(r({},t),((n={})[o]=e.props[o],n))}),{})},o.prototype.render=function(){var t=this,o=this.state.showModal,n=this.props,c=n.styled,i=n.onLoad,s=n.onChargeSuccess,l=n.onChargeFailure,u=n.checkoutId,d=n.chargeId,p=n.customMetadata,h=n.onPaymentDetected,m=n.disableCaching,f=n.wrapperStyle,g=n.className,y=n.children,x={onLoad:i,onChargeSuccess:s,onChargeFailure:l,checkoutId:u,chargeId:d,onPaymentDetected:h,disableCaching:m},b=this.getButtonProps();return e.createElement("div",{style:f},e.createElement("a",{href:"https://commerce.coinbase.com",rel:"external",title:"Pay with Bitcoin, Bitcoin Cash, DAI, Litecoin, Dogecoin, Ethereum, or USD Coin",onClick:function(e){e.preventDefault()}},e.createElement("button",r({},b,{className:c?"coinbase-commerce-button":g,onClick:function(){t.onClick()}}),null!=y?y:"Buy crypto")),o&&e.createElement(a,r({},x,{onModalClose:function(){t.onModalClose()},onError:function(e){t.handleError(e)},customMetadata:p})))},o.defaultProps={styled:!1,disableCaching:!1},o}(t);export{c as CoinbaseCommerceButton};
//# sourceMappingURL=index.js.map
