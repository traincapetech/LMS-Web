"use strict";var e=require("react"),t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},t(e,o)};function o(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}var n=function(){return n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)},r=function(t){function n(e){var o=t.call(this,e)||this;return o.origin="https://commerce.coinbase.com",o.uuid=o.generateUUID(),o.listenerHandleMessage=function(e){o.handleMessage(e)},o.state={loading:!0,src:null},o}return o(n,t),n.prototype.componentDidMount=function(){window.addEventListener("message",this.listenerHandleMessage);var e=window.location,t=e.hostname,o=e.port,n=e.protocol,r="".concat(n,"//").concat(t).concat(o?":".concat(o):"","/");this.setState({src:this.buildSrc(r)})},n.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.listenerHandleMessage)},n.prototype.render=function(){var t=this,o=this.state,n=o.loading,r=o.src;return e.createElement("div",{className:"coinbase-commerce-iframe-container"},(n||null===r)&&e.createElement("div",{className:"commerce-loading-spinner"}),null!==r&&e.createElement("iframe",{onLoad:function(){t.handleIFrameLoaded()},className:"coinbase-commerce-iframe",src:r,style:{border:0},scrolling:"no"}))},n.prototype.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},n.prototype.buildSrc=function(e){var t,o,n=this.props,r=n.checkoutId,a=n.chargeId,c=n.customMetadata,i=n.disableCaching;if(r)o=r,t="checkout";else{if(!a)throw new Error("must supply either checkoutId or chargeId prop");o=a,t="charges"}var s={origin:e,buttonId:this.uuid,cacheDisabled:i};c&&("string"!=typeof c?console.error('Received customMetadata not of "string" type. Ignoring.'):s.custom=c);var l=Object.keys(s).map((function(e){return"".concat(window.encodeURIComponent(e),"=").concat(window.encodeURIComponent(s[e]))})).join("&");return"".concat(this.origin,"/embed/").concat(t,"/").concat(encodeURI(o),"?").concat(l)},n.prototype.isValidMessage=function(e){return e.origin===this.origin&&e.data.buttonId===this.uuid},n.prototype.handleMessage=function(e){if(this.isValidMessage(e)){var t=this.props,o=t.onChargeSuccess,n=t.onChargeFailure,r=t.onModalClose,a=t.onError,c=t.onPaymentDetected;switch(e.data.event){case"charge_confirmed":null==o||o(e.data);break;case"charge_failed":null==n||n(e.data);break;case"payment_detected":null==c||c(e.data);break;case"error_not_found":a(e.data);break;case"checkout_modal_closed":r()}}},n.prototype.handleIFrameLoaded=function(){var e,t;this.setState({loading:!1}),null===(t=(e=this.props).onLoad)||void 0===t||t.call(e)},n}(e.Component),a=function(t){function a(e){var o=t.call(this,e)||this;return o.state={showModal:!1},o}return o(a,t),a.prototype.onClick=function(){this.setState({showModal:!0})},a.prototype.onModalClose=function(){var e=this.props.onModalClosed;this.setState({showModal:!1}),null!=e&&e()},a.prototype.handleError=function(e){console.error(e),this.onModalClose()},a.prototype.getButtonProps=function(){var e=this,t=["onLoad","onChargeSuccess","onChargeFailure","customMetadata","onPaymentDetected","onModalClosed","checkoutId","chargeId","disableCaching","wrapperStyle","styled"];return Object.keys(n({},this.props)).filter((function(e){return!t.includes(e)})).reduce((function(t,o){var r;return n(n({},t),((r={})[o]=e.props[o],r))}),{})},a.prototype.render=function(){var t=this,o=this.state.showModal,a=this.props,c=a.styled,i=a.onLoad,s=a.onChargeSuccess,l=a.onChargeFailure,u=a.checkoutId,d=a.chargeId,p=a.customMetadata,h=a.onPaymentDetected,m=a.disableCaching,f=a.wrapperStyle,g=a.className,y=a.children,x={onLoad:i,onChargeSuccess:s,onChargeFailure:l,checkoutId:u,chargeId:d,onPaymentDetected:h,disableCaching:m},C=this.getButtonProps();return e.createElement("div",{style:f},e.createElement("a",{href:"https://commerce.coinbase.com",rel:"external",title:"Pay with Bitcoin, Bitcoin Cash, DAI, Litecoin, Dogecoin, Ethereum, or USD Coin",onClick:function(e){e.preventDefault()}},e.createElement("button",n({},C,{className:c?"coinbase-commerce-button":g,onClick:function(){t.onClick()}}),null!=y?y:"Buy crypto")),o&&e.createElement(r,n({},x,{onModalClose:function(){t.onModalClose()},onError:function(e){t.handleError(e)},customMetadata:p})))},a.defaultProps={styled:!1,disableCaching:!1},a}(e.Component);exports.CoinbaseCommerceButton=a;
//# sourceMappingURL=index.js.map
